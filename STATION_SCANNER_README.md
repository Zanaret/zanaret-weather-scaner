# Weather Station Scanner

A JavaScript program that scans all Environment Canada weather stations and generates individual files with their most recent weather report links.

## Features

- üîç **Comprehensive Scanning**: Scans all 200+ weather stations in Quebec
- üìÅ **File Generation**: Creates individual files for each station in the `Stations/` folder
- üîó **Direct Links**: Includes direct links to the most recent weather data XML files
- üìä **Progress Tracking**: Real-time progress updates and statistics
- üåê **Web Interface**: Beautiful web interface with live progress tracking
- üíª **Command Line**: Node.js script for command-line execution

## Files Created

### Core Files
- `station-scanner.js` - Main scanner class (works in browser and Node.js)
- `station-scanner.html` - Web interface for running the scanner
- `run-scanner.js` - Node.js command-line script

### Generated Files
- `Stations/SCAN_SUMMARY.md` - Initial scan summary with all stations
- `Stations/SCAN_RESULTS.md` - Final results with statistics
- `Stations/[StationName]_[StationCode].md` - Individual station files

## Usage

### Option 1: Web Interface (Recommended)

1. Open `station-scanner.html` in your web browser
2. Click "üöÄ Start Scan" to begin scanning all stations
3. Watch real-time progress and statistics
4. Use "üì• Download All Files" to download all generated files
5. View results in the tables below

**Features:**
- Real-time progress bar
- Live statistics updates
- Detailed log output
- Stop/start controls
- Results tables
- Bulk download option

### Option 2: Command Line (Node.js)

1. Install Node.js dependencies (if needed):
   ```bash
   npm install xmldom node-fetch
   ```

2. Run the scanner:
   ```bash
   node run-scanner.js
   ```

3. Files will be generated directly in the `Stations/` folder

### Option 3: Programmatic Usage

```javascript
// In browser or Node.js
const scanner = new StationScanner();
await scanner.scanAllStations();
```

## Generated File Format

Each station file contains:

```markdown
# [Station Name] Weather Station

**Station Code:** [Station Code]
**Location:** [Latitude], [Longitude]
**Coordinates:** [Formatted Coordinates]

## Most Recent Weather Report

**Status:** ‚úÖ Data Available
**Found in Hour:** [Hour]
**Timestamp:** [Timestamp]
**Total Files Found:** [Count]

### Weather Data URL
```
[Direct URL to XML file]
```

### Direct Link
[View Latest Weather Data]([URL])

### File Details
- **Filename:** [Filename]
- **Size:** [Size]
- **Context:** [Context]

---
*Generated by Weather Station Scanner on [Date]*
*Data source: Environment Canada (dd.meteo.gc.ca)*
```

## Example Output

### Successful Station
```markdown
# Montr√©al Weather Station

**Station Code:** s0000635
**Location:** 45.53N, 73.56O
**Coordinates:** 45.5300¬∞N, -73.5600¬∞W

## Most Recent Weather Report

**Status:** ‚úÖ Data Available
**Found in Hour:** 20
**Timestamp:** 2024-01-15T20:03:38.917Z
**Total Files Found:** 1

### Weather Data URL
```
https://dd.meteo.gc.ca/today/citypage_weather/QC/20/20240115T200338.917Z_MSC_CitypageWeather_s0000635_fr.xml
```

### Direct Link
[View Latest Weather Data](https://dd.meteo.gc.ca/today/citypage_weather/QC/20/20240115T200338.917Z_MSC_CitypageWeather_s0000635_fr.xml)
```

### Failed Station
```markdown
# [Station Name] Weather Station

**Station Code:** [Code]
**Location:** [Lat], [Lon]
**Coordinates:** [Formatted]

## Weather Report Status

**Status:** ‚ùå No Data Available
**Error:** No XML files found for station
**Timestamp:** [Timestamp]

### Troubleshooting
- The station may be temporarily offline
- Data may not be available for this station
- Try checking again later
```

## Station Information

The scanner includes all Environment Canada weather stations in Quebec:

- **Total Stations:** 200+
- **Coverage:** All of Quebec
- **Data Source:** Environment Canada (dd.meteo.gc.ca)
- **Update Frequency:** Hourly
- **Format:** XML files with French weather data

## Technical Details

### API Endpoints
- **Base URL:** `https://dd.meteo.gc.ca/today/citypage_weather/QC/`
- **Proxy:** Uses `https://api.allorigins.win/raw?url=` for CORS support
- **File Format:** `_fr.xml` (French weather data)

### Scanning Process
1. **Initialization:** Loads all station data from embedded XML
2. **Current Hour Check:** Searches current hour first for latest data
3. **Historical Search:** Searches previous 24 hours if current hour has no data
4. **File Generation:** Creates individual files for each station
5. **Summary Creation:** Generates summary files with statistics

### Error Handling
- Network timeouts and retries
- Invalid station codes
- Missing data files
- Server errors
- Rate limiting (500ms delays between requests)

## Browser Compatibility

The web interface works in all modern browsers:
- Chrome/Chromium
- Firefox
- Safari
- Edge

## Node.js Requirements

For command-line usage:
- Node.js 14+ (for fetch API support)
- Optional: `xmldom` package for XML parsing
- Optional: `node-fetch` package for fetch API (if not using Node.js 18+)

## Performance

- **Scan Duration:** ~10-15 minutes for all stations
- **Rate Limiting:** 500ms delay between requests
- **Memory Usage:** Minimal (processes one station at a time)
- **Network Usage:** ~2-3 requests per station

## Troubleshooting

### Common Issues

1. **No data found for stations**
   - Some stations may be temporarily offline
   - Data may not be available for all stations
   - Try running the scan again later

2. **Network errors**
   - Check your internet connection
   - The proxy service may be temporarily unavailable
   - Try again in a few minutes

3. **Browser download issues**
   - Some browsers block multiple downloads
   - Use the "Download All Files" button instead of individual downloads
   - Check your browser's download settings

4. **Node.js errors**
   - Ensure you have Node.js 14+ installed
   - Install required dependencies: `npm install xmldom node-fetch`
   - Check file permissions for the Stations folder

### Getting Help

If you encounter issues:
1. Check the console/log output for error messages
2. Verify your internet connection
3. Try running the scan again
4. Check that the Stations folder is writable

## License

This project is open source and available under the MIT License. 